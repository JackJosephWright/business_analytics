make_hist <- function(data=df_crash, var = "AGE", yvar = "TARGET_FLAG") {
p <- ggplot(data,
aes_string(x=var,color=yvar, alpha=.5,fill=yvar)) +
geom_histogram()+ggtitle(paste(var,'by crash condition'))
}
make_i<-function(data=df_crash,xvar='KIDSDRIV',yvar='HOMEKIDS',cond='TARGET_FLAG'){
p<-ggplot(data,
aes_string(x=xvar,y=yvar,color=cond))+
geom_point()+geom_smooth(method='lm', se=FALSE)
}
make_bar<-function(data=df_crash,var='MSTATUS',yvar='HOMEKIDS',cond='TARGET_FLAG'){
p<-ggplot(data,
aes_string(x=var,color=cond,fill=cond))+geom_bar(position='dodge')+ggtitle(paste(var,'by crash condition'))
}
(x<-make_hist(var="KIDSDRIV"))
#(y<-make_box(var='KIDSDRIV'))
t<-table(df_crash$TARGET_FLAG,df_crash$KIDSDRIV)
fisher.test(table(df_crash$TARGET_FLAG,df_crash$KIDSDRIV))
prop.table(t)
(x<-make_box(var='AGE'))
(make_hist(var='HOMEKIDS'))
(make_i())
(make_box(var='YOJ'))
(make_hist(var='YOJ'))
YOJ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1)%>%pull(YOJ)
YOJ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0)%>%pull(YOJ)
ks.test(as.vector(YOJ_crash),as.vector(YOJ_no))
YOJ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & YOJ>0)%>%pull(YOJ)
YOJ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & YOJ>0)%>%pull(YOJ)
ks.test(as.vector(YOJ_crash),as.vector(YOJ_no))
df_crash<-df_crash%>%mutate(YOJ_ZERO=case_when(YOJ>0~FALSE,
TRUE~TRUE))
(make_box(var='INCOME'))
(make_hist(var='INCOME'))
INCOME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & INCOME>0)%>%pull(INCOME)
INCOME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & INCOME>0)%>%pull(INCOME)
ks.test(as.vector(INCOME_crash),as.vector(INCOME_no))
ggplot(df_crash,aes(x=PARENT1,color=TARGET_FLAG,fill=TARGET_FLAG))+geom_bar(position='dodge')
(make_box(var='HOME_VAL'))
(make_hist(var='HOME_VAL'))
HOME_VAL_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & HOME_VAL>100)%>%pull(HOME_VAL)
HOME_VAL_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & HOME_VAL>100)%>%pull(HOME_VAL)
ks.test(as.vector(HOME_VAL_crash),as.vector(HOME_VAL_no))
(make_bar())
(make_bar(var='SEX'))
t<-table(df_crash$TARGET_FLAG,df_crash$SEX)
chisq.test(t)
levels(df_crash$EDUCATION)
df_crash$EDUCATION<-as.factor(as.numeric(factor(df_crash$EDUCATION, levels=c('<High School','z_High School','Bachelors','Masters','PhD'),ordered=TRUE)))
(make_bar(var='EDUCATION'))
ggplot(df_crash,aes(y=(as.numeric(EDUCATION)^2),group=TARGET_FLAG,color=TARGET_FLAG))+geom_boxplot()
ggplot(df_crash,aes(x=as.numeric(EDUCATION),group=TARGET_FLAG,color=TARGET_FLAG))+geom_histogram(position='dodge')
chisq.test(table(df_crash$TARGET_FLAG,df_crash$EDUCATION))
str(df_crash)
(make_hist(var='JOB'))
(make_bar(var='JOB'))
(t<-table(df_crash$TARGET_FLAG,df_crash$JOB))
chisq.test(t)
(t<-table(df_crash$TARGET_FLAG,df_crash$JOB))
chisq.test(t)
t/nrow(df)
mean(df_crash$TARGET_FLAG)
mean(as.numeric(df_crash$TARGET_FLAG))
sum(as.numeric(df_crash$TARGET_FLAG))
df_crash$TARGET_FLAG
sum(df_crash$TARGET_FLAG)
sum(as.numeric(df_crash$TARGET_FLAG))
sum(as.numeric(df_crash%>%pull(TARGET_FLAG)))
nrow(df)
n_crash<-sum(as.numeric(df_crash%>%pull(TARGET_FLAG)))
n_no_crash<-nrow(df)-n_crash
p_crash<-n_crash/nrow(df_crash)
nrow(df_crash)
n_crash<-as.numeric(df_crash%>%pull(TARGET_FLAG))
length(n_crash)
nrow(df_crash)
n_crash<-sum(as.numeric(df_crash%>%pull(TARGET_FLAG)))
n_no_crash<-nrow(df_crash)-n_crash
p_crash<-n_crash/nrow(df_crash)
nrow(df_crash)
t/nrow(df_crash)
levels(df_crash$TARGET_FLAG)
nrow(df_crash)
df_crash%>%filter(TARGET_FLAG=='1')
count(df_crash%>%filter(TARGET_FLAG=='1'))
nrow(df_crash%>%filter(TARGET_FLAG=='1'))
n_crash<-nrow(df_crash%>%filter(TARGET_FLAG=='1'))
n_no_crash<-nrow(df_crash)-n_crash
n_crash<-nrow(df_crash%>%filter(TARGET_FLAG=='1'))
p_crash<-n_crash/nrow(df_crash)
p_no_crash<-n_no_crash/nrow(df_crash)
t[1,]
(t<-table(df_crash$TARGET_FLAG,df_crash$JOB))
t[1,]<-t[1,]/n_no_crash
t
t[2,]<-t[2,]/n_crash
t
(t<-table(df_crash$TARGET_FLAG,df_crash$JOB))
chisq.test(t)
str(df_crash)
(make_box(var='TRAVTIME'))
a<-(make_box(var='TRAVTIME'))
b<-(make_hist(var='TRAVTIME'))
ggarrange(a,b)
library(GGally)
ggarrange(a,b)
library(GGally)
library(ggpubr)
ggarrange(a,b)
TRAVTIME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(TRAVTIME)
TRAVTIME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(TRAVTIME)
ks.test(as.vector(TRAVTIME_crash),as.vector(TRAVTIME_no))
TRAVTIME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TRAVTIME>0)%>%pull(TRAVTIME)
TRAVTIME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TRAVTIME>0)%>%pull(TRAVTIME)
ks.test(as.vector(TRAVTIME_crash),as.vector(TRAVTIME_no))
TRAVTIME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TRAVTIME>10)%>%pull(TRAVTIME)
TRAVTIME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TRAVTIME>10)%>%pull(TRAVTIME)
ks.test(as.vector(TRAVTIME_crash),as.vector(TRAVTIME_no))
TRAVTIME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(TRAVTIME)
TRAVTIME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(TRAVTIME)
ks.test(as.vector(TRAVTIME_crash),as.vector(TRAVTIME_no))
str(df_crash)
df_crash$CAR_USE
str(df_crash)
(make_bar(var='CAR_USE'))
(make_box(var="BLUEBOOK"))
(make_box(var="TIF"))
a<-(make_box(var="TIF"))
b<-(make_hist(var="TIF"))
ggarrange(a,b)
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>2.5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>2.5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>4 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>3 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>3 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>4 )%>%pull(TIF)
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>4 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>3 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>3 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>3.5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>3.5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>4 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF<4 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF<4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF<2.5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF<2.5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>2.5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>2.5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
hist(TIF_crash)
hist(TIF_no_crash)
hist(TIF_no)
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>2.5 )%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>2.5 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>3)%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>3 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF>4)%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF>4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
TIF_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & TIF<4)%>%pull(TIF)
TIF_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & TIF<4 )%>%pull(TIF)
ks.test(as.vector(TIF_crash),as.vector(TIF_no))
ggplot(df_crash,aes(x=TIF,color=TARGET_FLAG))+ggeom_density()
ggplot(df_crash,aes(x=TIF,color=TARGET_FLAG))+geom_density()
ggplot(df_crash,aes(x=df_crash%>%filter(TIF>4),color=TARGET_FLAG))+geom_density()
ggplot(df_crash%>%filter(TIF>4),aes(x=TIF,color=TARGET_FLAG))+geom_density()
ggplot(df_crash,aes(x=TIF,color=TARGET_FLAG))+geom_density()
str(df_crash)
levels(as.factor(df_crash$TIF))
count(levels(as.factor(df_crash$TIF)))
count(as.factor(df_crash%>%filter(TARGET_FLAG=='1')%>%select(TIF)))
count((df_crash%>%filter(TARGET_FLAG=='1')%>%select(TIF))
count((df_crash%>%filter(TARGET_FLAG=='1')%>%select(TIF)))
table(df_crash$TARGET_FLAG,df_crash$TIF)
t<-table(df_crash$TARGET_FLAG,df_crash$TIF)
t.T
transpose(t)
t(t)
tt<-as.data.frame(t(t))
View(tt)
tt<-select(-Var1)
tt<-tt%>%select(-Var1)
t<-table(df_crash$TARGET_FLAG,df_crash$TIF)
tt<as.data.frame(t(t))
tt<_as.data.frame(t(t))
tt<-as.data.frame(t(t))
View(tt)
tt<-tt%>%select(-Var2)
View(tt)
t<-table(df_crash$TARGET_FLAG,df_crash$TIF)
tt<-as.data.frame(t(t))
t<-table(df_crash$TARGET_FLAG,df_crash$TIF)
t
t[1,]
t[1,]%>%pull()
t[1,]%>%unlist()
t[3,]<-t[1,]-t[2,]
t[1,]-t[2,]
sum(t[1,])
sum(t[2,])
t[1,]<-t[1,]/sum(t[1,])
t[2,]<-t[2,]/sum(t[2,])
t
t_df<-t[1,]-t[2,]
t_dif<-t[1,]-t[2,]
t_dif
t_dif$names
class(t_dif)
names(t_dif)
loess(names(t_dif)~t_dif)
t_df<-data.frame(index=names(t_dif),values=t_dif)
ggplot(t_df, aes(x=index,y=values))+geom_smooth()
ggplot(t_df, aes(x=index,y=v))+geom_point()
t_df<-data.frame(index=names(t_dif),v=t_dif)
ggplot(t_df, aes(x=index,y=v))+geom_point()
ggplot(t_df, aes(x=index,y=v))+geom_point()+geom_smooth()
str(df_crash$CAR_TYPE)
(make_bar(var='CAR_TYPE'))
(t<-table(df_crash$TARGET_FLAG,df_crash$CAR_TYPE))
chisq.test(t)
(t<-table(df_crash$TARGET_FLAG,df_crash$CAR_TYPE))
(t<-table(df_crash$TARGET_FLAG,df_crash$CAR_TYPE))
chisq.test(t)
str(df_crash)
(make_bar(var='RED_CAR'))
t<-table(df_crash$TARGET_FLAG,df_crash$RED_CAR)
chisq.test(t)
(make_hist(var='OLDCLAIM'))
OLDCLAIM_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(OLDCLAIM)
OLDCLAIM_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(OLDCLAIM)
ks.test(as.vector(OLDCLAIM_crash),as.vector(OLDCLAIM_no))
OLDCLAIM_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & OLDCLAIM>0)%>%pull(OLDCLAIM)
OLDCLAIM_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & OLDCLAIM>0 )%>%pull(OLDCLAIM)
ks.test(as.vector(OLDCLAIM_crash),as.vector(OLDCLAIM_no))
temp<-df_crash%>%mutate(case_when(OLDCLAIM==0~TRUE,
TRUE~FALSE))
View(temp)
temp<-df_crash%>%mutate(case_when(OLDCLAIM_ZERO=OLDCLAIM==0~TRUE,
TRUE~FALSE))
View(temp)
temp<-df_crash%>%mutate(OLDCLAIM_ZERO=case_when(OLDCLAIM==0~TRUE,
TRUE~FALSE))
View(temp)
df_crash<-df_crash%>%mutate(OLDCLAIM_ZERO=case_when(OLDCLAIM==0~TRUE,
TRUE~FALSE))
str(df_crash)
summary(df_crash$CLM_FREQ)
(make_box(var='CLM_FREQ'))
a<-(make_box(var='CLM_FREQ'))
b<-(make_hist(var='CLM_FREQ'))
ggarrange(a,b)
CLM_FREQ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & CLM_FREQ>0)%>%pull(CLM_FREQ)
CLM_FREQ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & CLM_FREQ>0 )%>%pull(CLM_FREQ)
ks.test(as.vector(CLM_FREQ_crash),as.vector(CLM_FREQ_no))
df_crash<-df_crash%>%mutate(CLM_FREQ_ZERO=case_when(CLM_FREQ==0~TRUE,
TRUE~FALSE))
(make_i(xvar='OLDCLAIM',yvar='CLM_FREQ'))
(make_i(xvar='CLM_FREQ',yvar="OLDCLAIM"))
table(df_crash$OLDCLAIM_ZERO,df_crash$CLM_FREQ_ZERO)
str(df_crash)
(make_bar(var="REVOKED"))
t<-table(df_crash$TARGET_FLAG,df_crash$REVOKED)
t
(make_box(var="MVR_PTS"))
b<-(make_hist(var='MVR_PTS'))
a<-(make_box(var="MVR_PTS"))
b<-(make_hist(var='MVR_PTS'))
ggarrange(a,b)
ggarrange(a,b)
a<-make_hist(var="CAR_AGE")
b<-make_hist(var='CAR_AGE')
ggarrange(a,b)
a<-make_box(var="CAR_AGE")
b<-make_hist(var='CAR_AGE')
ggarrange(a,b)
CAR_AGE_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(CAR_AGE)
CAR_AGE_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(CAR_AGE)
ks.test(as.vector(CAR_AGE_crash),as.vector(CAR_AGE_no))
CAR_AGE_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & CAR_AGE>2 )%>%pull(CAR_AGE)
CAR_AGE_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & CAR_AGE>2)%>%pull(CAR_AGE)
ks.test(as.vector(CAR_AGE_crash),as.vector(CAR_AGE_no))
CAR_AGE_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & CAR_AGE>3 )%>%pull(CAR_AGE)
CAR_AGE_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & CAR_AGE>3)%>%pull(CAR_AGE)
ks.test(as.vector(CAR_AGE_crash),as.vector(CAR_AGE_no))
str(df_crash)
(make_bar(var='URBANICITY'))
glm(TARGET_FLAG~.,family=binomial(), data=df_crash)
glm_full<-glm(TARGET_FLAG~.,family=binomial(), data=df_crash)
summary(glm_full)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(GGally)
library(here)
file<-here('data','insurance_training_data.csv')
df_raw<-read_csv(file)
summary(df_raw)
#get rid of all dollar signs and commas in the prices
df<-mutate_if(as_tibble(df_raw),
is.character,
str_replace_all, pattern='\\$|,',replacement='')
#convertito numeric if the column seems numeric
is_all_numeric <- function(x) {
!any(is.na(suppressWarnings(as.numeric(na.omit(x))))) & is.character(x)
}
df<-df %>%
mutate_if(is_all_numeric,as.numeric)
#converting to factor
factor_list<-list('TARGET_FLAG',"MSTATUS",'SEX','EDUCATION','JOB','CAR_USE','URBANICITY','CAR_TYPE','PARENT1','RED_CAR','REVOKED')
df<-df %>%
mutate_each_(funs(factor(.)),factor_list)
str(df)
df_1<-na.omit(df)
df_crash<-df_1%>%select(-c(INDEX,TARGET_AMT))
df_crash_base<-df_crash
#function to make a hist vs target flag
make_box <- function(data=df_crash, var = "AGE", xvar = "TARGET_FLAG") {
p <- ggplot(data,
aes_string(y = var,color=xvar)) +
geom_boxplot()+ggtitle(paste(var,'by crash condition'))
}
make_hist <- function(data=df_crash, var = "AGE", yvar = "TARGET_FLAG") {
p <- ggplot(data,
aes_string(x=var,color=yvar, alpha=.5,fill=yvar)) +
geom_histogram()+ggtitle(paste(var,'by crash condition'))
}
make_i<-function(data=df_crash,xvar='KIDSDRIV',yvar='HOMEKIDS',cond='TARGET_FLAG'){
p<-ggplot(data,
aes_string(x=xvar,y=yvar,color=cond))+
geom_point()+geom_smooth(method='lm', se=FALSE)
}
make_bar<-function(data=df_crash,var='MSTATUS',yvar='HOMEKIDS',cond='TARGET_FLAG'){
p<-ggplot(data,
aes_string(x=var,color=cond,fill=cond))+geom_bar(position='dodge')+ggtitle(paste(var,'by crash condition'))
}
(x<-make_hist(var="KIDSDRIV"))
#(y<-make_box(var='KIDSDRIV'))
t<-table(df_crash$TARGET_FLAG,df_crash$KIDSDRIV)
fisher.test(table(df_crash$TARGET_FLAG,df_crash$KIDSDRIV))
prop.table(t)
(x<-make_box(var='AGE'))
(make_hist(var='HOMEKIDS'))
(make_i())
(make_box(var='YOJ'))
(make_hist(var='YOJ'))
YOJ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1)%>%pull(YOJ)
YOJ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0)%>%pull(YOJ)
ks.test(as.vector(YOJ_crash),as.vector(YOJ_no))
YOJ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & YOJ>0)%>%pull(YOJ)
YOJ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & YOJ>0)%>%pull(YOJ)
ks.test(as.vector(YOJ_crash),as.vector(YOJ_no))
df_crash<-df_crash%>%mutate(YOJ_ZERO=case_when(YOJ>0~FALSE,
TRUE~TRUE))
(make_box(var='INCOME'))
(make_hist(var='INCOME'))
INCOME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & INCOME>0)%>%pull(INCOME)
INCOME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & INCOME>0)%>%pull(INCOME)
ks.test(as.vector(INCOME_crash),as.vector(INCOME_no))
ggplot(df_crash,aes(x=PARENT1,color=TARGET_FLAG,fill=TARGET_FLAG))+geom_bar(position='dodge')
(make_box(var='HOME_VAL'))
(make_hist(var='HOME_VAL'))
HOME_VAL_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & HOME_VAL>100)%>%pull(HOME_VAL)
HOME_VAL_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & HOME_VAL>100)%>%pull(HOME_VAL)
ks.test(as.vector(HOME_VAL_crash),as.vector(HOME_VAL_no))
(make_bar())
(make_bar(var='SEX'))
t<-table(df_crash$TARGET_FLAG,df_crash$SEX)
chisq.test(t)
levels(df_crash$EDUCATION)
df_crash$EDUCATION<-as.factor(as.numeric(factor(df_crash$EDUCATION, levels=c('<High School','z_High School','Bachelors','Masters','PhD'),ordered=TRUE)))
(make_bar(var='EDUCATION'))
ggplot(df_crash,aes(y=(as.numeric(EDUCATION)^2),group=TARGET_FLAG,color=TARGET_FLAG))+geom_boxplot()
ggplot(df_crash,aes(x=as.numeric(EDUCATION),group=TARGET_FLAG,color=TARGET_FLAG))+geom_histogram(position='dodge')
chisq.test(table(df_crash$TARGET_FLAG,df_crash$EDUCATION))
(make_bar(var='JOB'))
(t<-table(df_crash$TARGET_FLAG,df_crash$JOB))
chisq.test(t)
a<-(make_box(var='TRAVTIME'))
b<-(make_hist(var='TRAVTIME'))
library(ggpubr)
ggarrange(a,b)
TRAVTIME_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 )%>%pull(TRAVTIME)
TRAVTIME_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 )%>%pull(TRAVTIME)
ks.test(as.vector(TRAVTIME_crash),as.vector(TRAVTIME_no))
(make_bar(var='CAR_USE'))
(make_box(var="BLUEBOOK"))
a<-(make_box(var="TIF"))
b<-(make_hist(var="TIF"))
ggarrange(a,b)
ggplot(df_crash,aes(x=TIF,color=TARGET_FLAG))+geom_density()
(make_bar(var='CAR_TYPE'))
(t<-table(df_crash$TARGET_FLAG,df_crash$CAR_TYPE))
chisq.test(t)
(make_bar(var='RED_CAR'))
t<-table(df_crash$TARGET_FLAG,df_crash$RED_CAR)
chisq.test(t)
(make_hist(var='OLDCLAIM'))
OLDCLAIM_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & OLDCLAIM>0)%>%pull(OLDCLAIM)
OLDCLAIM_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & OLDCLAIM>0 )%>%pull(OLDCLAIM)
ks.test(as.vector(OLDCLAIM_crash),as.vector(OLDCLAIM_no))
df_crash<-df_crash%>%mutate(OLDCLAIM_ZERO=case_when(OLDCLAIM==0~TRUE,
TRUE~FALSE))
a<-(make_box(var='CLM_FREQ'))
b<-(make_hist(var='CLM_FREQ'))
ggarrange(a,b)
CLM_FREQ_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & CLM_FREQ>0)%>%pull(CLM_FREQ)
CLM_FREQ_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & CLM_FREQ>0 )%>%pull(CLM_FREQ)
ks.test(as.vector(CLM_FREQ_crash),as.vector(CLM_FREQ_no))
df_crash<-df_crash%>%mutate(CLM_FREQ_ZERO=case_when(CLM_FREQ==0~TRUE,
TRUE~FALSE))
table(df_crash$OLDCLAIM_ZERO,df_crash$CLM_FREQ_ZERO)
(make_bar(var="REVOKED"))
a<-(make_box(var="MVR_PTS"))
b<-(make_hist(var='MVR_PTS'))
ggarrange(a,b)
a<-make_box(var="CAR_AGE")
b<-make_hist(var='CAR_AGE')
ggarrange(a,b)
CAR_AGE_crash<-df_crash%>%dplyr::filter(TARGET_FLAG==1 & CAR_AGE>3 )%>%pull(CAR_AGE)
CAR_AGE_no<-df_crash%>%dplyr::filter(TARGET_FLAG==0 & CAR_AGE>3)%>%pull(CAR_AGE)
ks.test(as.vector(CAR_AGE_crash),as.vector(CAR_AGE_no))
(make_bar(var='URBANICITY'))
glm_list<-list()
glm_list[['base']]<-glm(
TARGET_FLAG~.,
family=binomial(),
data=df_
)
glm_list<-list()
glm_list[['base']]<-glm(
TARGET_FLAG~.,
family=binomial(),
data=df_crash_base
)
glm_list[['full']]<-glm(
TARGET_FLAG~.,
family=binomial(),
data=df_crash
)
glm_list[['back']]<-step(glm_list[['full']])
glm_list<-list()
glm_list[['base']]<-glm(
TARGET_FLAG~.,
family=binomial(),
data=df_crash_base
)
glm_list[['full']]<-glm(
TARGET_FLAG~.,
family=binomial(),
data=df_crash
)
glm_list[['back']]<-step(glm_list[['full']])
lapply(
X=glm_list,
FUN = AIC
)
lapply(
X=glm_list,
FUN = function(x){
deviance_x<-deviance(
object = x
)
df.residual_x<-df.residual(
object = x
)
p.value = pchisq(
q=deviance_x,
df = df.residual_x,
lower.tail = FALSE
)
v<-c(
deviance = deviance_x,
df = df.residual_x,
p.value = p.value
)
return(v)
}
)
mmps(glm_list[['back']])
?mmps
library(car)
mmps(glm_list[['back']])
df_predict<-df_crash%>%dplyr::select(-TARGET_FLAG)
predictions<-predict(glm_list[['back']],newdata=df_predict,type='response')
df_predict<-df_crash%>%dplyr::select(-TARGET_FLAG)
predictions<-predict(glm_list[['back']],newdata=df_predict,type='response')
res_df<-data.frame(t=df_rash$TARGET_FLAG,prediction=predictions)
df_predict<-df_crash%>%dplyr::select(-TARGET_FLAG)
predictions<-predict(glm_list[['back']],newdata=df_predict,type='response')
res_df<-data.frame(t=df_crash$TARGET_FLAG,prediction=predictions)
res_df<-res_df%>%mutate(p=as.factor(case_when(prediction>.5 ~1, TRUE~0)))%>%dplyr::select(-prediction)
library(caret)
confusionMatrix(as.factor(res_df$p),as.factor(res_df$t))
